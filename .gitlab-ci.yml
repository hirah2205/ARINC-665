default:
  image: git.thomas-vogt.de:5050/thomas-vogt/docker-gcc-clang-cmake:latest
  retry:
    max: 1
    when:
      - unknown_failure
      - api_failure
      - stuck_or_timeout_failure
      - runner_system_failure
      - stale_schedule

workflow:
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"

.cmake_build:
  stage: build
  script:
    - cmake --preset ${CMAKE_PRESET}
    - cmake --build --preset ${CMAKE_PRESET} --target all doc
    - ctest --preset ${CMAKE_PRESET}

GCC Static Debug:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "gcc-static-debug"

GCC Static Release:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "gcc-static-release"

GCC Shared Debug:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "gcc-shared-debug"

GCC Shared Release:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "gcc-shared-release"

CLang Static Debug:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "clang-static-debug"

CLang Static Release:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "clang-static-release"

CLang Shared Debug:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "clang-shared-debug"

CLang Shared Release:
  extends: .cmake_build
  variables:
    CMAKE_PRESET: "clang-shared-release"
